import { renderToString } from "react-dom/server";
import { createStaticHandler } from "react-router";

import Router, { routeStack } from "../router";
import { baseurl } from "../config";

const renderFactory: import("@kosmojs/dev").SSRFactory = async (url) => {
  const handler = createStaticHandler(routeStack, { basename: baseurl });
  const context = await handler.query(new Request(`http://localhost${url}`));
  return {
    renderToString() {
      const html = renderToString(Router({ context } as never));
      return { html };
    },
  };
};

export default renderFactory;
