import { renderToString } from "react-dom/server";

import { routes } from "{{importPathmap.react}}/server";
import App from "../App";
import createRouter from "../router";

export default {
  async factory(url) {
    const router = await createRouter(App, routes, { url });
    return {
      async renderToString({ criticalCss }) {
        const head = criticalCss
          .map(({ text }) => `<style>${text}</style>`)
          .join("\n");

        const html = renderToString(router);

        return { head, html };
      },
    };
  },
} satisfies import("@kosmojs/dev").SSRSetup;
