import type { RouteDefinitionItem } from "@kosmojs/api";

import type {
  ParameterizedMiddleware,
} from "{{ createImport "libApi" }}";

import {
  type DefineRouteFactory,
  defineRouteFactory,
} from "{{ createImport "lib" "api:route" }}";

type ParamsTuple = [{{#each paramsSchema}}unknown?,{{/each}}];

type ParamsMapper<T extends ParamsTuple> = {
  {{#each paramsSchema}}
  "{{name}}"{{#unless isRequired}}?{{/unless}}: T[{{@index}}] extends undefined
    ? string
    : T[{{@index}}];
  {{/each}}
};

export const defineRoute: <
  ParamsT extends ParamsTuple = [
    {{#each paramsSchema}}string{{#unless isRequired}}?{{/unless}},
    {{/each}}
  ],
  StateT extends object = object,
  ContextT extends object = object
>(factory: DefineRouteFactory<ParamsMapper<ParamsT>, StateT, ContextT>) => Array<
  RouteDefinitionItem<
    ParameterizedMiddleware<ParamsMapper<ParamsT>, StateT, ContextT>
  >
> = (factory) => defineRouteFactory(factory);
