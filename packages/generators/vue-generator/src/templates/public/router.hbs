import type { App } from "vue";
import {
  type RouteRecordRaw,
  createRouter,
  createWebHistory,
  createMemoryHistory,
} from "vue-router";

import { baseurl } from "./config";

export default async (
  app: App,
  routes: Array<RouteRecordRaw>,
  ssrProps?: { url: URL },
) => {
  const router = createRouter({
    history: ssrProps
      ? createMemoryHistory(baseurl)
      : createWebHistory(baseurl),
    routes,
    strict: true,
  });

  if (ssrProps?.url) {
    await router.push(ssrProps.url.pathname);
    await router.isReady();
  }

  app.use(router);

  return router;
};
