import { createSSRApp } from "vue";
import { renderToString } from "vue/server-renderer";

import { routes } from "{{importPathmap.vue}}/server";
import App from "../App.vue";
import createRouter from "../router";

export default {
  async factory(url) {
    const app = createSSRApp(App);
    await createRouter(app, routes, { url });
    return {
      async renderToString({ criticalCss }) {
        const head = criticalCss
          .map(({ text }) => `<style>${text}</style>`)
          .join("\n");

        const html = await renderToString(app);

        return { head, html };
      },
    };
  },
} satisfies import("@kosmojs/dev").SSRSetup;
