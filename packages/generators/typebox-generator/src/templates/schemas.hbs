import type { ValidationSchemas } from "@kosmojs/api";

import { validationSchemaFactory } from "{{ createImport "lib" "@typebox" }}";

const schemas = {
{{#each resolvedTypes}}  {{name}}: `{{text}}`,
{{/each}}
}

export const validationSchemas: ValidationSchemas = {
  params: validationSchemaFactory(
    schemas.{{route.params.id}},
    { route: "{{route.name}}", target: "params" },
  ),

  {{#each requestSchemas}}
  {{target}}: {
    {{#each methods}}
    {{method}}: {
      schema: validationSchemaFactory(
        schemas.{{schema.id}},
        { route: "{{route}}", target: "{{target}}" },
      ),
      {{#if runtimeValidation}}
      runtimeValidation: {{runtimeValidation}},
      {{/if}}
      {{#if customErrors}}
      customErrors: {{customErrors}},
      {{/if}}
    },
    {{/each}}
  },
  {{/each}}

  response: {
  {{#each responseSchemas}}
    {{method}}: [
      {{#each variants}}
      {
        status: {{status}},
        {{#if contentType}}
        contentType: "{{contentType}}",
        {{/if}}
        {{#if resolvedType}}
        schema: validationSchemaFactory(
          schemas.{{id}},
          { route: "{{route}}", target: "{{target}}" },
        ),
        {{/if}}
        {{#if runtimeValidation}}
        runtimeValidation: {{runtimeValidation}},
        {{/if}}
        {{#if customErrors}}
        customErrors: {{customErrors}},
        {{/if}}
      },
      {{/each}}
    ],
  {{/each}}
  },
};
